---
export const prerender = false;

import Hero from "@/components/Hero.astro";
import Section from "@/components/Section.astro";
import Layout from "@/layouts/Layout.astro";
import { getHeaderLinks } from "@/lib/get-header-links";
import { getWrappedSdk } from "@/lib/get-wrapped-sdk";
import { Image } from "astro:assets";
import magicalCosplayConLogo from "@/images/magical_cosplay_con_logo.svg";
import EventInfo from "@/components/EventInfo.astro";
import { getTypedTableData } from "@/lib/get-typed-table-data";

const sdk = getWrappedSdk();
const { data } = await sdk.Layout();
const {
  data: { cosplayCon },
} = await sdk.CosplayCon();

Astro.response.headers.set(
  "Cache-Control",
  "public, max-age=1800, s-maxage=1800"
);
---

<Layout
  title={cosplayCon!.seo!.metaTitle}
  description={cosplayCon!.seo!.metaDescription}
  headerLinks={getHeaderLinks(data)}
  class="bg-fuchsia-200"
>
  <Hero
    bgColorClass="bg-fuchsia-950"
    gradientClass="from-violet-200 to-pink-200"
    text="Magical activities and cosplays"
    class="text-white"
  >
    <Image
      slot="logo"
      src={magicalCosplayConLogo}
      height="300"
      width="480"
      alt="Magical Cosplay Con logo"
      widths={[240, 540, 720, magicalCosplayConLogo.width]}
    />
  </Hero>
  <EventInfo {...cosplayCon?.eventInfo!} />
  {
    cosplayCon?.sections?.map((section, i) => (
      <Section
        headingGradientClass="from-[#232946] to-indigo-600"
        title={section!.title}
        subText={section!.subText!}
        {...(i % 2 !== 0 && { class: "bg-white" })}
      >
        {section!.Images.length ? (
          <div
            slot="content"
            class="container max-w-5xl mx-auto flex justify-center flex-col items-center mt-6"
          >
            <div class="flex gap-10 flex-col md:flex-row">
              {section!.Images.map((image) => (
                <Image
                  src={image!.url}
                  alt={image?.alternativeText ?? image!.name}
                  quality={90}
                  width={image!.width!}
                  height={image!.height!}
                  class="rounded-lg max-w-96"
                />
              ))}
            </div>
          </div>
        ) : null}
        {section?.table ? (
          <div
            slot="content"
            class="container max-w-5xl mx-auto flex justify-center flex-col items-center mt-6"
          >
            <table class="table-auto md:table-fixed text-left">
              <thead>
                <tr>
                  {getTypedTableData(section.table).columns.map((column) => (
                    <th class="px-6">{column.label}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {getTypedTableData(section.table).rows.map((row) => (
                  <tr>
                    {row.map((content) => (
                      <td class="px-6">{content}</td>
                    ))}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        ) : null}
      </Section>
    ))
  }
</Layout>
